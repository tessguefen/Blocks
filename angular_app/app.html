<style>.angular-ui-tree-dropzone,.angular-ui-tree-empty{border:1px dashed #bbb;min-height:100px;background-color:#e5e5e5;background-image:-webkit-linear-gradient(45deg,#fff 25%,transparent 0,transparent 75%,#fff 0,#fff),-webkit-linear-gradient(45deg,#fff 25%,transparent 0,transparent 75%,#fff 0,#fff);background-image:linear-gradient(45deg,#fff 25%,transparent 0,transparent 75%,#fff 0,#fff),linear-gradient(45deg,#fff 25%,transparent 0,transparent 75%,#fff 0,#fff);background-size:60px 60px;background-position:0 0,30px 30px}.angular-ui-tree-empty{pointer-events:none}.angular-ui-tree-nodes{position:relative;margin:0;padding:0;list-style:none}.angular-ui-tree-nodes .angular-ui-tree-nodes{padding-left:20px;padding-right:20px}.angular-ui-tree-node,.angular-ui-tree-placeholder{position:relative;margin:0;padding:0;min-height:20px;line-height:20px}.angular-ui-tree-hidden{display:none}.cmps_options-button,.layoutcomponent_component-name,.layoutcomponent_img_button{display:inline-block}.angular-ui-tree-placeholder{margin:10px;padding:0;min-height:30px}.angular-ui-tree-handle{cursor:move;text-decoration:none;box-sizing:border-box;min-height:20px;line-height:20px}.angular-ui-tree-drag{position:absolute;pointer-events:none;z-index:999;opacity:.8}.angular-ui-tree-drag .tree-node-content{margin-top:0}tr.angular-ui-tree-empty{height:100px}.group-title{background-color:#687074!important;color:#FFF!important}.tree-node{border:1px solid #dae2ea;background:#f8faff;color:#7c9eb2}.nodrop{background-color:#f2dede}.tree-node-content{margin:10px}.tree-handle{padding:10px;background:#428bca;color:#FFF;margin-right:10px}.angular-ui-tree-placeholder{background:#e5e5e5;border:2px dashed #d5d5d5;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}.cmp_container_wrap,.cmp_item_wrap{border:1px solid #e0e0e0;transition:all 450ms cubic-bezier(.23,1,.32,1) 0s}.cmps_options{text-align:right;float:right}.cmps_options-button{margin-left:1.5rem;padding:4px 10px 2px;font-size:16px;background:rgba(255,255,255,.45);position:relative;top:-1px;line-height:14px;cursor:pointer;color:#000}.cmp_container,.cmp_item{position:relative;min-width:100%;height:44px;overflow:hidden;white-space:nowrap;color:#444;font-size:14px;padding:2px 12px;line-height:36px}.cmp_container_wrap{background-color:#fff;color:#444;box-sizing:border-box;margin-bottom:32px;padding-bottom:20px}.cmp_container,.cmp_item_wrap{box-sizing:border-box;-webkit-tap-highlight-color:transparent;margin-bottom:20px}.cmp_container{background-color:#fff;border-bottom:1px solid #e0e0e0}.cmp_item_wrap{background-color:#f1f1f1}.layoutcomponent_button{padding:.25rem .75rem;display:inline-block;cursor:pointer}.layoutcomponent_required{font-weight:700}.layoutcomponent_error{color:red}.layoutcomponent_buttonrow{text-align:right;margin:1rem 0}#layoutcomponent_add_mmdialog td label,#layoutcomponent_edit_mmdialog td label{display:block}</style>

<div id="mm9_screen_update_message_container" class="mm9_screen_update_message_container" style="top: 0;">
	<span id="mm9_screen_update_message" class="mm9_screen_update_message">{{ data.notification_message }}</span>
</div>

<div class="layoutcomponent_buttonrow" ng-if="data.can_add">

	<span ng-click="newComponent( data.layout )" class="mm9_button_light">
		<span class="mm9_button_image mm9_mivaicon" style="display: inline-block;">&#57347;</span>
		<span class="mm9_button_text" style="padding-left: 5px;">Add New Component</span>
	</span>

</div>
<!-- Nested node template -->
<script type="text/ng-template" id="nodes_renderer.html">
	<div ui-tree-handle ng-class="{ 'cmp_container' : node.component.allow_children, 'cmp_item' : !node.component.allow_children }" ng-init="checkNodes( node )">
		<span class="layoutcomponent_component-name">{{node.component.name}} <strong>&nbsp;&nbsp;{{node.name}}</strong> <em ng-if="!node.active">&nbsp;&nbsp;Inactive</em></span>
		<span class="cmps_options">
			<span ng-if="node.component.allow_children" ng-if="data.can_add && data.can_edit && node.component.allow_children" ng-click="newComponent( this )" data-nodrag class="layoutcomponent_button mm9_button_light" title="Add Child Component">
				<span class="mm9_button_image mm9_mivaicon" style="display: inline-block;"></span>
			</span>

			<span ng-if="data.can_edit" ng-click="editComponent( this, node )" data-nodrag class="layoutcomponent_button mm9_button_light" title="Edit Component">
				<span class="mm9_button_image mm9_mivaicon" style="display: inline-block;"></span>
			</span>

			<span ng-if="data.can_delete" ng-click="removeComponent( this, node )" data-nodrag class="layoutcomponent_button mm9_button_light" title="Delete Component">
				<span class="mm9_button_image mm9_mivaicon" style="display: inline-block;"></span>
			</span>
		</span>
	</div>
	<ol ng-attr-data-nodrop-enabled="{{ node.component.allow_children ? undefined : true  }}" ui-tree-nodes="" ng-model="node.nodes">
		<li ng-repeat="node in node.nodes" ui-tree-node ng-include="'nodes_renderer.html'" ng-class="{ 'cmp_container_wrap' : node.component.allow_children, 'cmp_item_wrap' : !node.component.allow_children }">
		</li>
	</ol>
</script>

<div ui-tree>
	<ol ui-tree-nodes="" ng-model="data.layout.nodes" id="tree-root">
		<li ng-attr-data-nodrop-enabled="{{ node.component.allow_children ? undefined : true  }}" ng-repeat="node in data.layout.nodes" ng-class="{ 'cmp_container_wrap' : node.component.allow_children, 'cmp_item_wrap' : !node.component.allow_children }" ui-tree-node ng-include="'nodes_renderer.html'"></li>
	</ol>
</div>

<!-- Layout Component ADD Dialog -->
<div id="layoutcomponent_add_mmdialog" class="mm9_dialog">
	<div class="mm9_dialog_container">
		<div id="layoutcomponent_add_mmdialog_content_container" class="mm9_dialog_content_container">
			<div id="layoutcomponent_add_mmdialog_close" class="mm9_dialog_close mm9_mivaicon"></div>
			<div id="layoutcomponent_add_mmdialog_title" class="mm9_dialog_title">
				Add New Component
			</div>
			<div id="layoutcomponent_add_mmdialog_content" class="mm9_dialog_content mm9_dialog_content_body">
				<div ng-form="newComponentForm" id="js-newComponentForm">
					<table width="100%">
						<tr ng-if="data.components.length > 0" ng-class="{ 'layoutcomponent_error' : data.popup_show_errors && newComponentForm.layoutcomponent_component.$invalid }">
							<td valign="top" nowrap><span class="layoutcomponent_required">Select Component:</span></td>
							<td valign="top" width="100%">
								<select name="layoutcomponent_component" ng-model="data.newComponent.component" required>
									<option ng-repeat="component in data.components track by component.id" ng-value="component">{{ component.name }}</option>
								</select>
							</td>
						</tr>
						<tr ng-if="data.newComponent.component.descrip">
							<td valign="top" nowrap>Component Description:</td>
							<td valign="top" width="100%;">{{ data.newComponent.component.descrip }}</td>
						</tr>
						<tr ng-if="data.newComponent.component.image">
							<td valign="top" colspan="2">
								<img ng-src="{{ data.newComponent.component.image }}" style="max-width:125px; max-height: 125px;" />
								<br /><em>Reference Image</em>
							</td>
						</tr>
						<tr ng-if="data.newComponent.component.id > 0">
							<td colspan="2">
								<label>
									<input type="checkbox" name="layoutcomponent_active" ng-model="data.newComponent.active" ng-true-value="1" ng-false-value="0"> Active
								</label>
							</td>
						</tr>
						<tr ng-class="{ 'layoutcomponent_error' : data.popup_show_errors && newComponentForm.layoutcomponent_name.$invalid }">
							<td valign="top" nowrap><span class="layoutcomponent_required">Name:</span></td>
							<td valign="top" width="100%"><input type="text" name="layoutcomponent_name" ng-model="data.newComponent.name" required /></td>
						</tr>
						<tr ng-if="data.newComponent.component.id > 0" ng-repeat="attribute in data.newComponent.component.attributes" ng-class="{ 'layoutcomponent_error' : newComponent_Validation( attribute, $index ) }">
							<td valign="top" nowrap><span ng-if="attribute.type != 'checkbox'" ng-class="{ 'layoutcomponent_required' : attribute.required }">{{ attribute.prompt }}:</span></td>
							<td valign="top" width="100%" ng-if="attribute.type == 'text'">
								<input type="text" placeholder="{{ attribute.prompt }}" name="layoutcomponent_{{$index}}" ng-model="attribute.value" ng-required="{{ attribute.required ? true : false }}" />
							</td>
							<td valign="top" width="100%" ng-if="attribute.type == 'memo'">
								<textarea placeholder="{{ attribute.prompt }}" name="layoutcomponent_{{$index}}" ng-model="attribute.value" ng-required="{{ attribute.required ? true : false }}"></textarea>
							</td>
							<td valign="top" width="100%" ng-if="attribute.type == 'select'">
								<select name="layoutcomponent_{{$index}}" ng-model="attribute.value" ng-required="{{ attribute.required ? true : false }}" ng-init="attribute.value = attribute.value || ''">
									<option value="">-- Select One --</option>
									<option ng-repeat="option in attribute.options track by option.id" ng-value="option.prompt">{{ option.prompt }}</option>
								</select>
							</td>
							<td valign="top" width="100%" ng-if="attribute.type == 'radio'">
								<label ng-repeat="option in attribute.options">
									<input type="radio" name="layoutcomponent_{{$index}}" ng-model="attribute.value" ng-value="option.prompt" ng-required="{{ attribute.required ? true : false }}"> {{ option.prompt }}
								</label>
							</td>
							<td valign="top" width="100%" ng-if="attribute.type == 'checkbox'">
								<label>
									<input type="checkbox" name="layoutcomponent_{{$index}}" ng-model="attribute.value" ng-required="{{ attribute.required ? true : false }}" ng-true-value="1" ng-false-value="0"><span ng-class="{ 'layoutcomponent_required' : attribute.required }">{{ attribute.prompt }}</span>
								</label>
							</td>
							<td valign="top" width="100%" ng-if="attribute.type == 'product'">
								<input id="js-attribute_{{ attribute.id }}" type="text" placeholder="{{ attribute.prompt }}" name="layoutcomponent_{{$index}}" ng-model="attribute.value" ng-required="{{ attribute.required ? true : false }}" />
								<span class="mm9_button_light layoutcomponent_img_button" ng-click="productPopup( 'js-attribute_' + attribute.id )">
									<span class="mm9_button_image mm9_mivaicon" style="display: inline-block;"></span>
									<span class="mm9_button_text" style="padding-left: 5px;">Lookup Product</span>
								</span>
							</td>
							<td valign="top" width="100%" ng-if="attribute.type == 'category'">
								<input id="js-attribute_{{ attribute.id }}" type="text" placeholder="{{ attribute.prompt }}" name="layoutcomponent_{{$index}}" ng-model="attribute.value" ng-required="{{ attribute.required ? true : false }}" />
								<span class="mm9_button_light layoutcomponent_img_button" ng-click="categoryPopup( 'js-attribute_' + attribute.id )">
									<span class="mm9_button_image mm9_mivaicon" style="display: inline-block;"></span>
									<span class="mm9_button_text" style="padding-left: 5px;">Lookup Category</span>
								</span>
							</td>
							<td valign="top" width="100%" ng-if="attribute.type == 'image'">
								<div ng-if="attribute.value"><img ng-src="{{ attribute.value }}" style="max-width:100px; max-height: 100px;" title="Image for {{ attribute.prompt }}" alt="Image for {{ attribute.prompt }}" /></div>
								<input id="js-attribute_{{ attribute.id }}" type="text" placeholder="{{ attribute.prompt }}" name="layoutcomponent_{{$index}}" ng-model="attribute.value" ng-required="{{ attribute.required ? true : false }}" />
								<span class="mm9_button_light layoutcomponent_img_button" ng-click="imageUpload( 'js-attribute_' + attribute.id )">
									<span class="mm9_button_image mm9_mivaicon" style="display: inline-block;"></span>
									<span class="mm9_button_text" style="padding-left: 5px;">Select Image</span>
								</span>
							</td>
							<td valign="top" width="100%" ng-if="attribute.type == 'link'">
								<select name="layoutcomponent_type_{{$index}}" ng-model="attribute.link.type" ng-required="{{ attribute.required ? true : false }}" id="js-attribute_{{ attribute.id }}" ng-init="attribute.link.type = attribute.link.type || 'N'">
									<option value="N">None</option>
									<option value="U">URL</option>
									<option value="P">Product</option>
									<option value="C">Category</option>
									<option value="G">Page</option>
								</select>
								<input ng-if="attribute.link.type && attribute.link.type != 'N'" name="layoutcomponent_link_{{$index}}" required type="text" ng-model="attribute.link.value" id="js-attribute_link_{{ attribute.id }}" />
								<span ng-if="attribute.link.type && attribute.link.type != 'N' && attribute.link.type != 'U'" class="mm9_button_light layoutcomponent_img_button" ng-click="linkPopup( attribute )">
									<span class="mm9_button_image mm9_mivaicon" style="display: inline-block;"></span>
									<span ng-if="attribute.link.type == 'P'" class="mm9_button_text" style="padding-left: 5px;">Lookup Product</span>
									<span ng-if="attribute.link.type == 'C'" class="mm9_button_text" style="padding-left: 5px;">Lookup Category</span>
									<span ng-if="attribute.link.type == 'G'" class="mm9_button_text" style="padding-left: 5px;">Lookup Page</span>
								</span>
							</td>
						</tr>
					</table>
				</div>
			</div>
			<div id="layoutcomponent_add_mmdialog_actionbar" class="mm9_dialog_actionbar"></div>
		</div>
		<div id="layoutcomponent_add_mmdialog_resize_top" class="mm9_dialog_resize_top"></div>
		<div id="layoutcomponent_add_mmdialog_resize_right" class="mm9_dialog_resize_right"></div>
		<div id="layoutcomponent_add_mmdialog_resize_bottom" class="mm9_dialog_resize_bottom"></div>
		<div id="layoutcomponent_add_mmdialog_resize_left" class="mm9_dialog_resize_left"></div>
		<div id="layoutcomponent_add_mmdialog_resize_topright" class="mm9_dialog_resize_topright"></div>
		<div id="layoutcomponent_add_mmdialog_resize_bottomright" class="mm9_dialog_resize_bottomright"></div>
		<div id="layoutcomponent_add_mmdialog_resize_bottomleft" class="mm9_dialog_resize_bottomleft"></div>
		<div id="layoutcomponent_add_mmdialog_resize_topleft" class="mm9_dialog_resize_topleft"></div>
	</div>
</div>
<!-- Layout Component ADD Dialog -->

<!-- Layout Component EDIT Dialog -->
<div id="layoutcomponent_edit_mmdialog" class="mm9_dialog">
	<div class="mm9_dialog_container">
		<div id="layoutcomponent_edit_mmdialog_content_container" class="mm9_dialog_content_container">
			<div id="layoutcomponent_edit_mmdialog_close" class="mm9_dialog_close mm9_mivaicon"></div>
			<div id="layoutcomponent_edit_mmdialog_title" class="mm9_dialog_title">
				Edit Component
			</div>
			<div id="layoutcomponent_edit_mmdialog_content" class="mm9_dialog_content mm9_dialog_content_body">
				<div ng-form="editComponentForm" id="js-editComponentForm">
					<table width="100%">
						<tr>
							<td valign="top" nowrap>Component:</td>
							<td valign="top" width="100%"><strong>{{ data.editComponent.component.name }}</strong></td>
						</tr>
						<tr ng-if="data.editComponent.component.descrip">
							<td valign="top" nowrap>Component Description:</td>
							<td valign="top" width="100%;">{{ data.editComponent.component.descrip }}</td>
						</tr>
						<tr ng-if="data.editComponent.component.image">
							<td valign="top" colspan="2">
								<img ng-src="{{ data.editComponent.component.image }}" style="max-width:125px; max-height: 125px;" />
								<br /><em>Reference Image</em>
							</td>
						</tr>
						<tr ng-if="data.editComponent.component.id > 0">
							<td colspan="2">
								<label>
									<input type="checkbox" name="layoutcomponent_active" ng-model="data.editComponent.active" ng-true-value="1" ng-false-value="0"> Active
								</label>
							</td>
						</tr>
						<tr ng-class="{ 'layoutcomponent_error' : data.popup_show_errors && editComponentForm.layoutcomponent_name.$invalid }">
							<td valign="top" nowrap><span class="layoutcomponent_required">Name:</span></td>
							<td valign="top" width="100%"><input type="text" name="layoutcomponent_name" ng-model="data.editComponent.name" required /></td>
						</tr>
						<tr ng-if="data.editComponent.component.id > 0" ng-repeat="attribute in data.editComponent.component.attributes" ng-class="{ 'layoutcomponent_error' : editComponent_Validation( attribute, $index) }">
							<td valign="top" nowrap><span ng-if="attribute.type != 'checkbox'" ng-class="{ 'layoutcomponent_required' : attribute.required }">{{ attribute.prompt }}:</span></td>
							<td valign="top" width="100%" ng-if="attribute.type == 'text'">
								<input type="text" placeholder="{{ attribute.prompt }}" name="layoutcomponent_{{$index}}" ng-model="attribute.value" ng-required="{{ attribute.required ? true : false }}" />
							</td>
							<td valign="top" width="100%" ng-if="attribute.type == 'memo'">
								<textarea placeholder="{{ attribute.prompt }}" name="layoutcomponent_{{$index}}" ng-model="attribute.value" ng-required="{{ attribute.required ? true : false }}"></textarea>
							</td>
							<td valign="top" width="100%" ng-if="attribute.type == 'select'">
								<select name="layoutcomponent_{{$index}}" ng-model="attribute.value" ng-required="{{ attribute.required ? true : false }}" id="js-attribute_{{ attribute.id }}">
									<option value="">-- Select One --</option>
									<option ng-repeat="option in attribute.options" ng-value="option.prompt">{{ option.prompt }}</option>
								</select>
							</td>
							<td valign="top" width="100%" ng-if="attribute.type == 'radio'">
								<label ng-repeat="option in attribute.options">
									<input type="radio" name="layoutcomponent_{{$index}}" ng-model="attribute.value" ng-value="option.prompt" ng-required="{{ attribute.required ? true : false }}"> {{ option.prompt }}
								</label>
							</td>
							<td valign="top" width="100%" ng-if="attribute.type == 'checkbox'">
								<label>
									<input type="checkbox" name="layoutcomponent_{{$index}}" ng-model="attribute.value" ng-required="{{ attribute.required ? true : false }}" ng-true-value="1" ng-false-value="0"><span ng-class="{ 'layoutcomponent_required' : attribute.required }">{{ attribute.prompt }}</span>
								</label>
							</td>
							<td valign="top" width="100%" ng-if="attribute.type == 'product'">
								<input id="js-attribute_{{ attribute.id }}" type="text" placeholder="{{ attribute.prompt }}" name="layoutcomponent_{{$index}}" ng-model="attribute.product.code" ng-required="{{ attribute.required ? true : false }}" />
								<span class="mm9_button_light layoutcomponent_img_button" ng-click="productPopup( 'js-attribute_' + attribute.id )">
									<span class="mm9_button_image mm9_mivaicon" style="display: inline-block;"></span>
									<span class="mm9_button_text" style="padding-left: 5px;">Lookup Product</span>
								</span>
							</td>
							<td valign="top" width="100%" ng-if="attribute.type == 'category'">
								<input id="js-attribute_{{ attribute.id }}" type="text" placeholder="{{ attribute.prompt }}" name="layoutcomponent_{{$index}}" ng-model="attribute.category.code" ng-required="{{ attribute.required ? true : false }}" />
								<span class="mm9_button_light layoutcomponent_img_button" ng-click="categoryPopup( 'js-attribute_' + attribute.id )">
									<span class="mm9_button_image mm9_mivaicon" style="display: inline-block;"></span>
									<span class="mm9_button_text" style="padding-left: 5px;">Lookup Category</span>
								</span>
							</td>
							<td valign="top" width="100%" ng-if="attribute.type == 'image'">
								<div ng-if="attribute.value"><img ng-src="{{ attribute.value }}" style="max-width:100px; max-height: 100px;" title="Image for {{ attribute.prompt }}" alt="Image for {{ attribute.prompt }}" /></div>
								<input id="js-attribute_{{ attribute.id }}" type="text" placeholder="{{ attribute.prompt }}" name="layoutcomponent_{{$index}}" ng-model="attribute.value" ng-required="{{ attribute.required ? true : false }}" />
								<span class="mm9_button_light layoutcomponent_img_button" ng-click="imageUpload( 'js-attribute_' + attribute.id )">
									<span class="mm9_button_image mm9_mivaicon" style="display: inline-block;"></span>
									<span class="mm9_button_text" style="padding-left: 5px;">Select Image</span>
								</span>
							</td>
							<td valign="top" width="100%" ng-if="attribute.type == 'link'">
								<select name="layoutcomponent_type_{{$index}}" ng-model="attribute.link.type" ng-required="{{ attribute.required ? true : false }}" id="js-attribute_{{ attribute.id }}" ng-init="attribute.link.type = attribute.link.type || 'N'">
									<option value="N">None</option>
									<option value="U">URL</option>
									<option value="P">Product</option>
									<option value="C">Category</option>
									<option value="G">Page</option>
								</select>
								<input ng-if="attribute.link.type && attribute.link.type != 'N'" name="layoutcomponent_link_{{$index}}" required type="text" ng-model="attribute.link.value" id="js-attribute_link_{{ attribute.id }}" />
								<span ng-if="attribute.link.type && attribute.link.type != 'N' && attribute.link.type != 'U'" class="mm9_button_light layoutcomponent_img_button" ng-click="linkPopup( attribute )">
									<span class="mm9_button_image mm9_mivaicon" style="display: inline-block;"></span>
									<span ng-if="attribute.link.type == 'P'" class="mm9_button_text" style="padding-left: 5px;">Lookup Product</span>
									<span ng-if="attribute.link.type == 'C'" class="mm9_button_text" style="padding-left: 5px;">Lookup Category</span>
									<span ng-if="attribute.link.type == 'G'" class="mm9_button_text" style="padding-left: 5px;">Lookup Page</span>
								</span>
							</td>
						</tr>
					</table>
				</div>
			</div>
			<div id="layoutcomponent_edit_mmdialog_actionbar" class="mm9_dialog_actionbar"></div>
		</div>
		<div id="layoutcomponent_edit_mmdialog_resize_top" class="mm9_dialog_resize_top"></div>
		<div id="layoutcomponent_edit_mmdialog_resize_right" class="mm9_dialog_resize_right"></div>
		<div id="layoutcomponent_edit_mmdialog_resize_bottom" class="mm9_dialog_resize_bottom"></div>
		<div id="layoutcomponent_edit_mmdialog_resize_left" class="mm9_dialog_resize_left"></div>
		<div id="layoutcomponent_edit_mmdialog_resize_topright" class="mm9_dialog_resize_topright"></div>
		<div id="layoutcomponent_edit_mmdialog_resize_bottomright" class="mm9_dialog_resize_bottomright"></div>
		<div id="layoutcomponent_edit_mmdialog_resize_bottomleft" class="mm9_dialog_resize_bottomleft"></div>
		<div id="layoutcomponent_edit_mmdialog_resize_topleft" class="mm9_dialog_resize_topleft"></div>
	</div>
</div>
<!-- Layout Component EDIT Dialog -->