<style>
.angular-ui-tree-dropzone,.angular-ui-tree-empty{border:1px dashed #bbb;min-height:100px;background-color:#e5e5e5;background-image:-webkit-linear-gradient(45deg,#fff 25%,transparent 0,transparent 75%,#fff 0,#fff),-webkit-linear-gradient(45deg,#fff 25%,transparent 0,transparent 75%,#fff 0,#fff);background-image:linear-gradient(45deg,#fff 25%,transparent 0,transparent 75%,#fff 0,#fff),linear-gradient(45deg,#fff 25%,transparent 0,transparent 75%,#fff 0,#fff);background-size:60px 60px;background-position:0 0,30px 30px}.angular-ui-tree-empty{pointer-events:none}.angular-ui-tree-nodes{position:relative;margin:0;padding:0;list-style:none}.angular-ui-tree-nodes .angular-ui-tree-nodes{padding-left:20px; padding-right:20px;}.angular-ui-tree-node,.angular-ui-tree-placeholder{position:relative;margin:0;padding:0;min-height:20px;line-height:20px}.angular-ui-tree-hidden{display:none}.angular-ui-tree-placeholder{margin:10px;padding:0;min-height:30px}.angular-ui-tree-handle{cursor:move;text-decoration:none;font-weight:700;box-sizing:border-box;min-height:20px;line-height:20px}.angular-ui-tree-drag{position:absolute;pointer-events:none;z-index:999;opacity:.8}.angular-ui-tree-drag .tree-node-content{margin-top:0}

.btn {
	margin-right: 8px;
}

.angular-ui-tree-handle {

}

.angular-ui-tree-handle:hover {

}

.angular-ui-tree-placeholder {
	background: #f0f9ff;
	border: 2px dashed #bed2db;
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	box-sizing: border-box;
}

tr.angular-ui-tree-empty {
	height:100px
}

.group-title {
	background-color: #687074 !important;
	color: #FFF !important;
}


/* --- Tree --- */
.tree-node {
	border: 1px solid #dae2ea;
	background: #f8faff;
	color: #7c9eb2;
}

.nodrop {
	background-color: #f2dede;
}

.tree-node-content {
	margin: 10px;
}
.tree-handle {
	padding: 10px;
	background: #428bca;
	color: #FFF;
	margin-right: 10px;
}

.angular-ui-tree-handle:hover {
}

.angular-ui-tree-placeholder {
	background: #f0f9ff;
	border: 2px dashed #bed2db;
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
	box-sizing: border-box;
}

/*****/
.cmps_options {
	text-align: right;
	float: right;
}
.cmps_options-button {
	display: inline-block;
	margin-left: 1.5rem;
	padding: 4px 10px 2px;
	/* border: 1px solid #000; */
	font-size: 16px;
	background: rgba(255,255,255,.45);
	position: relative;
	top: -1px;
	line-height: 14px;
	cursor: pointer;
	color: #000;
}
.component_popup {
	display: none;
	position: absolute;
	width: 650px;
	background: #fff;
	top: 0;
	overflow: auto;
	margin: auto;
	left: 0;
	right: 0;
	z-index: 5;
	-webkit-box-shadow: 0px 0px 40px 1px rgba(0,0,0,0.35);
	-moz-box-shadow: 0px 0px 40px 1px rgba(0,0,0,0.35);
	box-shadow: 0px 0px 40px 1px rgba(0,0,0,0.35);
	margin-top: 1.5rem;
}
.component_popup-details,
.component_popup-title {
	padding: 1.5rem;
}
.component_popup-title {
	border-bottom: 1px solid #ccc;
}

.component_popup-background {
	display: none;
	position: absolute;
	top:0;
	left:0;
	bottom:0;
	right:0;
	width: 100%;
	height: 100%;
	z-index: 4;
	background: rgba(0,0,0, .25);
	cursor: pointer;
}
.component_popup.popup-show,
.component_popup-background.show {
	display: block;
}

.cmp_container_wrap {
	color: #444;
	background-color: #fff;
	transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms;
	box-sizing: border-box;
	-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
	box-shadow: rgba(0, 0, 0, 0.12) 0px 1px 6px, rgba(0, 0, 0, 0.12) 0px 1px 4px;
	border-radius: 2px;
	margin-bottom: 32px;
	padding-bottom: 20px;
}
.cmp_container {
	box-sizing: border-box;
	-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
	background-color: #f3f3f3;
	padding: 0.5rem 0.75rem;
	margin-bottom: 20px;
}
.cmp_item_wrap {
	color: #fff;
	background-color: #666;
	transition: all 450ms cubic-bezier(0.23, 1, 0.32, 1) 0ms;
	box-sizing: border-box;
	-webkit-tap-highlight-color: rgba(0, 0, 0, 0);
	box-shadow: rgba(0, 0, 0, 0.12) 0px 1px 6px, rgba(0, 0, 0, 0.12) 0px 1px 4px;
	border-radius: 0px;
	position: relative;
	width: 100%;
	padding: 0.5rem 0.75rem;
	margin-bottom: 20px;
}
.cmp_button {
	margin-bottom: 1.5rem;
	padding: 0.25rem 0.75rem;
	display: inline-block;
	cursor: pointer;
	border: 2px solid #444;
}
.component_popup__inner {
	position: relative;
}
.component_popup-exit {
	position: absolute;
	top: 0.75rem;
	right: 0.75rem;
}
</style>


<div ng-controller="ComponentsController" ng-app="Components">
	<div class="component_popup-background" ng-class="{ 'show' : data.showPopUp }" ng-click="closePopup()"></div>
	
	<div>
		<span ng-click="scopeCreep()">Initiate Scope Creep</span>
	</div>
	<div>
		<span class="cmp_button" ng-click="newComponent( data.layout )">Add a Component</span>
	</div>
	<div>
		<span class="cmp_button" ng-click="saveLayout()">Save Layout</span>
	</div>
	<!-- Nested node template -->
	<script type="text/ng-template" id="nodes_renderer.html">
		<div ui-tree-handle ng-class="{ 'cmp_container' : node.component.allow_children, 'cmp_item' : !node.component.allow_children }" ng-init="checkNodes( node )">
			{{node.component.name}} - {{node.name}}
			<span class="cmps_options">
				<span ng-if="node.component.allow_children" ng-if="node.component.allow_children" class="cmps_options-button" ng-click="newComponent( this )" data-nodrag>+</span>
				<span ng-click="removeComponent( this, node )" class="cmps_options-button" data-nodrag>&times;</span>
			</span>
		</div>
		<ol ng-attr-data-nodrop-enabled="{{ node.component.allow_children ? undefined : true  }}" ui-tree-nodes="" ng-model="node.nodes">
			<li ng-repeat="node in node.nodes" ui-tree-node ng-include="'nodes_renderer.html'" ng-class="{ 'cmp_container_wrap' : node.component.allow_children, 'cmp_item_wrap' : !node.component.allow_children }">
			</li>
		</ol>
	</script>

	<div ui-tree>
		<ol ui-tree-nodes="" ng-model="data.layout.nodes" id="tree-root">
			<li ng-attr-data-nodrop-enabled="{{ node.component.allow_children ? undefined : true  }}" ng-repeat="node in data.layout.nodes" ng-class="{ 'cmp_container_wrap' : node.component.allow_children, 'cmp_item_wrap' : !node.component.allow_children }" ui-tree-node ng-include="'nodes_renderer.html'"></li>
		</ol>
	</div>


	<div class="component_popup" ng-class="{ 'popup-show' : data.showPopUp }">
		<div class="component_popup__inner">
			<span class="component_popup-exit" ng-click="closePopup()">&times;</span>

			<div class="component_popup-title" ng-if="( data.newComponent.component.name || data.newComponent.name )">
				<span class="component_popup-cmp">{{ data.newComponent.component.name }}</span>
				<span class="component_popup-name">{{ data.newComponent.name }}</span>
			</div>

			<div class="component_popup-details">
				<form name="newComponentForm" id="js-newComponentForm">
					<table>
						<tr ng-if="data.newComponent.component.image">
							<td colspan="2">
								<img ng-src="{{ data.newComponent.component.image }}" class="cmp_image" />
							</td>
						</tr>
						<tr ng-if="data.components.length > 0">
							<td>Select Component:</td>
							<td><select ng-options="option.name for option in data.components track by option.id" ng-model="data.newComponent.component" required></select></td>
						</tr>
						<tr>
							<td>Name</td>
							<td><input type="text" ng-model="data.newComponent.name" required /></td>
						</tr>
						<tr ng-if="data.newComponent.component.id > 0" ng-repeat="attribute in data.newComponent.component.attributes">
							<td>{{ attribute.prompt }}<span ng-if="attribute.required">*</span></td>
							<td ng-if="attribute.type == 'text'">
								<input type="text" placeholder="{{ attribute.prompt }}" ng-model="attribute.value" ng-attr-required="{{ attribute.required ? true : undefined }}" />
							</td>
							<td ng-if="attribute.type == 'textarea'">
								<textarea placeholder="{{ attribute.prompt }}" ng-model="attribute.value" ng-attr-required="{{ attribute.required ? true : undefined }}"></textarea>
							</td>
							<td ng-if="attribute.type == 'select'">
								<select ng-options="option.prompt for option in attribute.options track by option.id" ng-model="attribute.value" ng-attr-required="{{ attribute.required ? true : undefined }}"></select>
							</td>
							<td ng-if="attribute.type == 'radio'">
								<label ng-repeat="option in attribute.options">
									<input type="radio" ng-model="attribute.value" ng-value="option.prompt" ng-attr-required="{{ attribute.required ? true : undefined }}"> {{ attribute.prompt }}
								</label>
							</td>
							<td ng-if="attribute.type == 'radio'">
								<label>
									<input type="checkbox" ng-model="attribute.value" ng-attr-required="{{ attribute.required ? true : undefined }}"> {{ attribute.prompt }}
								</label>
							</td>
							<td ng-if="attribute.type == 'product'">
								<input id="js-attribute_{{ attribute.id }}" type="text" placeholder="{{ attribute.prompt }}" ng-model="attribute.value" ng-attr-required="{{ attribute.required ? true : undefined }}" />
								<span class="cmp_button" ng-click="productPopup( 'js-attribute_' + attribute.id )">PRODUCT LOOKUP</span>
							</td>
							<td ng-if="attribute.type == 'category'">
								<input id="js-attribute_{{ attribute.id }}" type="text" placeholder="{{ attribute.prompt }}" ng-model="attribute.value" ng-attr-required="{{ attribute.required ? true : undefined }}" />
								<span class="cmp_button" ng-click="categoryPopup( 'js-attribute_' + attribute.id )">CATEGORY LOOKUP</span>
							</td>
							<td ng-if="attribute.type == 'image'">
								<input id="js-attribute_{{ attribute.id }}" type="text" placeholder="{{ attribute.prompt }}" ng-model="attribute.value" ng-attr-required="{{ attribute.required ? true : undefined }}" />
								<span class="cmp_button" ng-click="imageUpload( 'Image', '', 'js-attribute_' + attribute.id )">IMAGE UPLOAD</span>
							</td>
						</tr>
						<tr ng-if="data.newComponent.component.id > 0">
							<td colspan="2">
								<span class="cmp_button" ng-click="insertComponent()">ADD COMPONENT</span>
							</td>
						</tr>
					</table>
				</form>
			</div>
		</div>


	</div>

	<hr />

	<pre class="code">{{ data | json }}</pre>
</div>